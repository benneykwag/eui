<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&#39;eui.button.UploadButton&#39;, {
    extend: &#39;Ext.form.field.FileButton&#39;,
    xtype: &#39;uploadbutton&#39;,
    defaultListenerScope: true,
    listeners: {
        change: function(fld) {
            var inputEl = fld.fileInputEl &amp;&amp; fld.fileInputEl.dom,
                file = inputEl &amp;&amp; inputEl.files,
                formData = new FormData(),
                xhr = new XMLHttpRequest(),
                msg,
                url = fld.url || &#39;/APPS/npComponent/xssWorkImport.do&#39;;
            if (!file || !file.length) return;
            file = file[0];
            if (Ext.isObject(fld.params)) {
            	Ext.Object.each(fld.params, function (k, v) {
            		formData.append(k, v);
            	});
            }
            formData.append(&#39;file&#39;, file);
            xhr.open(&#39;POST&#39;, url);
            xhr.addEventListener(&#39;load&#39;, function() {
                inputEl.value = null;
                msg.close();
                Ext.Msg.show({
                	title: &#39;INFO&#39;,
                	icon: Ext.Msg.INFO,
                	buttons: Ext.Msg.OK,
                	msg: &#39;업로드가 완료되었습니다&#39;
                });
            });
            xhr.addEventListener(&#39;progress&#39;, function(progress) {
            	if (progress.loaded) {
            		msg.updateProgress(progress.loaded);
            	} else {
            		msg.close();
            		Ext.Msg.show({
            			title: &#39;ERROR&#39;,
            			icon: Ext.Msg.ERROR,
            			buttons: Ext.Msg.OK,
            			msg: &#39;파일 업로드 중 에러가 발생하였습니다.&#39;
            		});
            	}
            });
            Ext.apply(xhr, {
                onloadstart: function() {
                    msg = Ext.Msg.show({
                        msg: &#39;업로드 중입니다&#39;,
                        wait: true
                    });
                }
            });
            xhr.send(formData);
        }
    }
});
</pre>
</body>
</html>
